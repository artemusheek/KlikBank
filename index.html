<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Банк "ФинансПро" - Онлайн банкинг</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Аутентификация */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .auth-tab.active {
            color: #4fc3f7;
            border-bottom: 2px solid #4fc3f7;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #bbdefb;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4fc3f7, #2979ff);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(41, 121, 255, 0.3);
        }

        /* Основной интерфейс */
        .main-interface {
            display: none;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 32px;
            color: #4fc3f7;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            text-align: right;
        }

        .user-info .name {
            font-weight: 600;
            color: #4fc3f7;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .balance-card h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #bbdefb;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: 700;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h3 {
            font-size: 22px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #bbdefb;
        }

        .clicker-area {
            text-align: center;
            padding: 20px;
        }

        #clickButton {
            background: linear-gradient(45deg, #4fc3f7, #2979ff);
            border: none;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 20px rgba(41, 121, 255, 0.3);
            margin: 20px 0;
        }

        #clickButton:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 25px rgba(41, 121, 255, 0.4);
        }

        .clicker-info {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .click-stat {
            text-align: center;
        }

        .click-stat h4 {
            font-size: 16px;
            color: #bbdefb;
            margin-bottom: 5px;
        }

        .click-stat p {
            font-size: 24px;
            font-weight: 600;
            color: #4fc3f7;
        }

        .transfer-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 16px;
            color: #bbdefb;
        }

        input, select {
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        button {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #4caf50, #2e7d32);
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(46, 125, 50, 0.3);
        }

        .transactions {
            margin-top: 30px;
        }

        .transactions h3 {
            margin-bottom: 15px;
        }

        #transactionsList {
            list-style-type: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4fc3f7;
            display: flex;
            justify-content: space-between;
        }

        .transaction-item.debit {
            border-left-color: #f44336;
        }

        .transaction-item.credit {
            border-left-color: #4caf50;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.5s ease;
            z-index: 1000;
        }

        .notification.success {
            background: #4caf50;
            color: white;
        }

        .notification.error {
            background: #f44336;
            color: white;
        }

        .notification.info {
            background: #2196f3;
            color: white;
        }

        .notification.show {
            transform: translateX(0);
        }

        .upgrades {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .upgrade-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .upgrade-item:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
        }

        .upgrade-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .upgrade-name {
            font-weight: 600;
            color: #4fc3f7;
        }

        .upgrade-cost {
            color: #ffb74d;
            margin-top: 5px;
        }

        .upgrade-income {
            color: #4caf50;
            margin-top: 5px;
        }

        .upgrade-level {
            color: #bb86fc;
            margin-top: 5px;
            font-size: 14px;
        }

        .users-list {
            margin-top: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .user-name {
            font-weight: 600;
            color: #4fc3f7;
        }

        .user-balance {
            color: #ffb74d;
        }
        
        .refresh-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-users {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-users input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #bbdefb;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
            color: #bbdefb;
        }
    </style>
</head>
<body>
    <!-- Аутентификация -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthForm('login')">Вход</div>
                <div class="auth-tab" onclick="showAuthForm('register')">Регистрация</div>
            </div>
            
            <form class="auth-form active" id="loginForm">
                <div class="input-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                
                <div class="input-group">
                    <label for="loginPassword">Пароль</label>
                    <input type="password" id="loginPassword" required>
                </div>
                
                <button type="submit" class="auth-btn">Войти</button>
            </form>
            
            <form class="auth-form" id="registerForm">
                <div class="input-group">
                    <label for="registerName">Имя и фамилия</label>
                    <input type="text" id="registerName" required>
                </div>
                
                <div class="input-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                
                <div class="input-group">
                    <label for="registerPassword">Пароль</label>
                    <input type="password" id="registerPassword" minlength="6" required>
                </div>
                
                <div class="input-group">
                    <label for="registerConfirmPassword">Подтвердите пароль</label>
                    <input type="password" id="registerConfirmPassword" required>
                </div>
                
                <button type="submit" class="auth-btn">Зарегистрироваться</button>
            </form>
        </div>
    </div>

    <!-- Основной интерфейс -->
    <div class="main-interface" id="mainInterface">
        <div class="container">
            <header>
                <div class="logo">
                    <i class="fas fa-university"></i>
                    <h1>Банк "ФинансПро"</h1>
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <div class="name" id="userName">Иван Иванов</div>
                        <div class="email" id="userEmail">user@example.com</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </header>

            <div class="balance-card">
                <h2>Ваш баланс</h2>
                <div class="balance-amount" id="balance">1 000 ₽</div>
            </div>

            <div class="main-content">
                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-mouse-pointer"></i> Заработок кликами</h3>
                        <button class="refresh-btn" onclick="updateUserData()">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                    </div>
                    <div class="clicker-area">
                        <p>Кликайте на кнопку, чтобы зарабатывать деньги</p>
                        <button id="clickButton">
                            <i class="fas fa-coins"></i><br>
                            Кликнуть!
                        </button>
                        <div class="clicker-info">
                            <div class="click-stat">
                                <h4>Кликов</h4>
                                <p id="clickCount">0</p>
                            </div>
                            <div class="click-stat">
                                <h4>Доход за клик</h4>
                                <p id="incomePerClick">1 ₽</p>
                            </div>
                            <div class="click-stat">
                                <h4>Пассивный доход</h4>
                                <p id="passiveIncome">0 ₽/сек</p>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;"><i class="fas fa-chart-line"></i> Улучшения</h3>
                    <div class="upgrades" id="upgradesContainer">
                        <!-- Улучшения будут добавлены через JavaScript -->
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-exchange-alt"></i> Перевод средств</h3>
                        <button class="refresh-btn" onclick="loadUsersList()">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                    </div>
                    
                    <div class="users-list">
                        <h4>Другие пользователи:</h4>
                        <div class="search-users">
                            <input type="text" id="searchUsers" placeholder="Поиск по имени или email..." oninput="filterUsers()">
                        </div>
                        <div id="usersList">
                            <!-- Список пользователей будет загружен здесь -->
                        </div>
                    </div>
                    
                    <form class="transfer-form" id="transferForm">
                        <div class="form-group">
                            <label for="recipient">Выберите получателя</label>
                            <select id="recipient" required>
                                <option value="" disabled selected>Выберите пользователя</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="amount">Сумма перевода (₽)</label>
                            <input type="number" id="amount" min="1" required placeholder="Введите сумму">
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Сообщение получателю</label>
                            <input type="text" id="message" placeholder="Например: За обед">
                        </div>
                        
                        <button type="submit">
                            <i class="fas fa-paper-plane"></i> Отправить перевод
                        </button>
                    </form>

                    <div class="transactions">
                        <h3><i class="fas fa-history"></i> История операций</h3>
                        <ul id="transactionsList">
                            <!-- Транзакции будут добавляться здесь -->
                        </ul>
                    </div>
                </div>
            </div>

            <footer>
                <p>Банк "ФинансПро" © 2023. Все права защищены.</p>
                <p>Круглосуточная поддержка: 8-800-123-45-67</p>
                <p>Всего пользователей: <span id="totalUsers">0</span></p>
            </footer>
        </div>
    </div>

    <!-- Уведомление -->
    <div class="notification" id="notification"></div>

    <script>
        // ОБЩАЯ БАНКОВСКАЯ СИСТЕМА
        const BANK_STORAGE_KEY = 'bank_system_data_v2';
        
        // Улучшения с возможностью многократной покупки
        const UPGRADES = [
            { 
                id: 1, 
                name: "Улучшенная мышь", 
                baseCost: 50, 
                costMultiplier: 1.15,
                incomeIncrease: 1, 
                type: "click",
                maxLevel: 100
            },
            { 
                id: 2, 
                name: "Процессор для майнинга", 
                baseCost: 200, 
                costMultiplier: 1.2,
                incomeIncrease: 5, 
                type: "click",
                maxLevel: 50
            },
            { 
                id: 3, 
                name: "Банковский вклад", 
                baseCost: 500, 
                costMultiplier: 1.25,
                incomeIncrease: 2, 
                type: "passive",
                maxLevel: 30
            },
            { 
                id: 4, 
                name: "Инвестиционный фонд", 
                baseCost: 1000, 
                costMultiplier: 1.3,
                incomeIncrease: 10, 
                type: "passive",
                maxLevel: 20
            },
            { 
                id: 5, 
                name: "Криптоферма", 
                baseCost: 5000, 
                costMultiplier: 1.4,
                incomeIncrease: 50, 
                type: "passive",
                maxLevel: 10
            }
        ];

        // Функции для работы с хранилищем
        function getBankData() {
            const data = localStorage.getItem(BANK_STORAGE_KEY);
            if (!data) {
                // Создаем пустые начальные данные
                const initialData = {
                    users: [],
                    transactions: []
                };
                localStorage.setItem(BANK_STORAGE_KEY, JSON.stringify(initialData));
                return initialData;
            }
            return JSON.parse(data);
        }

        function saveBankData(data) {
            localStorage.setItem(BANK_STORAGE_KEY, JSON.stringify(data));
        }

        function updateUserInStorage(userId, updates) {
            const bankData = getBankData();
            const userIndex = bankData.users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                bankData.users[userIndex] = { 
                    ...bankData.users[userIndex], 
                    ...updates,
                    lastUpdate: Date.now()
                };
                saveBankData(bankData);
                return bankData.users[userIndex];
            }
            return null;
        }

        function getUserFromStorage(userId) {
            const bankData = getBankData();
            return bankData.users.find(u => u.id === userId);
        }

        function getAllUsersFromStorage() {
            return getBankData().users;
        }

        function addTransactionToStorage(transaction) {
            const bankData = getBankData();
            bankData.transactions.push({
                ...transaction,
                id: Date.now().toString(),
                timestamp: new Date().toISOString()
            });
            saveBankData(bankData);
        }

        function getUserTransactionsFromStorage(userId) {
            const bankData = getBankData();
            return bankData.transactions
                .filter(t => t.senderId === userId || t.recipientId === userId)
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        // Текущий пользователь
        let currentUser = null;

        // DOM элементы
        const authContainer = document.getElementById('authContainer');
        const mainInterface = document.getElementById('mainInterface');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const notification = document.getElementById('notification');

        // Функции аутентификации
        function showAuthForm(formType) {
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            if (formType === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                loginForm.classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                registerForm.classList.add('active');
            }
        }

        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function loginUser(email, password) {
            const bankData = getBankData();
            const user = bankData.users.find(u => u.email === email && u.password === password);
            
            if (!user) {
                showNotification('Неверный email или пароль', 'error');
                return false;
            }
            
            // Убираем пароль из объекта пользователя
            const { password: _, ...userWithoutPassword } = user;
            currentUser = userWithoutPassword;
            
            // Сохраняем ID текущего пользователя
            localStorage.setItem('currentUserId', user.id);
            
            showMainInterface();
            showNotification(`Добро пожаловать, ${user.name}!`, 'info');
            return true;
        }

        function registerUser(name, email, password, confirmPassword) {
            if (password !== confirmPassword) {
                showNotification('Пароли не совпадают', 'error');
                return false;
            }
            
            if (password.length < 6) {
                showNotification('Пароль должен содержать минимум 6 символов', 'error');
                return false;
            }
            
            const bankData = getBankData();
            
            // Проверка, существует ли пользователь
            if (bankData.users.find(u => u.email === email)) {
                showNotification('Пользователь с таким email уже существует', 'error');
                return false;
            }
            
            // Создание нового пользователя
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password,
                balance: 1000,
                clickCount: 0,
                incomePerClick: 1,
                passiveIncome: 0,
                upgrades: {}, // Теперь объект с уровнями улучшений
                lastUpdate: Date.now()
            };
            
            bankData.users.push(newUser);
            saveBankData(bankData);
            
            showNotification('Регистрация успешна! Теперь вы можете войти.', 'success');
            showAuthForm('login');
            document.getElementById('loginEmail').value = email;
            return true;
        }

        function showMainInterface() {
            authContainer.style.display = 'none';
            mainInterface.style.display = 'block';
            
            updateUserData();
            loadUsersList();
            loadTransactions();
            initUpgrades();
            
            // Запускаем пассивный доход
            startPassiveIncome();
        }

        function updateUserData() {
            if (!currentUser) return;
            
            // Получаем актуальные данные пользователя
            const updatedUser = getUserFromStorage(currentUser.id);
            if (updatedUser) {
                const { password: _, ...userWithoutPassword } = updatedUser;
                currentUser = userWithoutPassword;
            }
            
            // Обновляем интерфейс
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('balance').textContent = `${currentUser.balance.toLocaleString('ru-RU')} ₽`;
            document.getElementById('clickCount').textContent = currentUser.clickCount.toLocaleString('ru-RU');
            document.getElementById('incomePerClick').textContent = `${currentUser.incomePerClick} ₽`;
            document.getElementById('passiveIncome').textContent = `${currentUser.passiveIncome} ₽/сек`;
            
            // Обновляем улучшения
            initUpgrades();
        }

        function loadUsersList() {
            const usersList = document.getElementById('usersList');
            const recipientSelect = document.getElementById('recipient');
            
            const allUsers = getAllUsersFromStorage();
            const otherUsers = allUsers.filter(user => user.id !== currentUser?.id);
            
            document.getElementById('totalUsers').textContent = allUsers.length;
            
            // Обновляем список пользователей
            if (otherUsers.length === 0) {
                usersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>Пока нет других пользователей</p>
                        <p style="font-size: 14px; margin-top: 10px;">Пригласите друзей зарегистрироваться!</p>
                    </div>
                `;
            } else {
                usersList.innerHTML = '';
                otherUsers.forEach(user => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <div class="user-name">${user.name}</div>
                            <div class="user-email">${user.email}</div>
                        </div>
                        <div class="user-balance">${user.balance.toLocaleString('ru-RU')} ₽</div>
                    `;
                    usersList.appendChild(userItem);
                });
            }
            
            // Обновляем выпадающий список
            recipientSelect.innerHTML = '<option value="" disabled selected>Выберите пользователя</option>';
            otherUsers.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.name} (${user.balance.toLocaleString('ru-RU')} ₽)`;
                recipientSelect.appendChild(option);
            });
        }

        function filterUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
            const usersList = document.getElementById('usersList');
            const allUsers = getAllUsersFromStorage();
            const otherUsers = allUsers.filter(user => 
                user.id !== currentUser?.id && 
                (user.name.toLowerCase().includes(searchTerm) || 
                 user.email.toLowerCase().includes(searchTerm))
            );
            
            usersList.innerHTML = '';
            if (otherUsers.length === 0) {
                usersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>Пользователи не найдены</p>
                    </div>
                `;
            } else {
                otherUsers.forEach(user => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <div class="user-name">${user.name}</div>
                            <div class="user-email">${user.email}</div>
                        </div>
                        <div class="user-balance">${user.balance.toLocaleString('ru-RU')} ₽</div>
                    `;
                    usersList.appendChild(userItem);
                });
            }
        }

        function loadTransactions() {
            const transactionsList = document.getElementById('transactionsList');
            transactionsList.innerHTML = '';
            
            if (!currentUser) return;
            
            const transactions = getUserTransactionsFromStorage(currentUser.id);
            
            if (transactions.length === 0) {
                transactionsList.innerHTML = `
                    <li class="empty-state" style="padding: 20px; text-align: center;">
                        <i class="fas fa-exchange-alt"></i>
                        <p>Нет операций</p>
                        <p style="font-size: 14px; margin-top: 10px;">Начните с перевода другу!</p>
                    </li>`;
                return;
            }
            
            transactions.forEach(transaction => {
                const isSender = transaction.senderId === currentUser.id;
                const transactionItem = document.createElement('li');
                transactionItem.className = `transaction-item ${isSender ? 'debit' : 'credit'}`;
                
                const date = new Date(transaction.timestamp).toLocaleString('ru-RU');
                
                transactionItem.innerHTML = `
                    <div class="transaction-details">
                        <div class="transaction-text">
                            ${isSender ? 
                                `Перевод для ${transaction.recipientName}` : 
                                `Перевод от ${transaction.senderName}`}
                            ${transaction.message ? ` (${transaction.message})` : ''}
                        </div>
                        <div class="transaction-time">${date}</div>
                    </div>
                    <div class="transaction-amount">
                        ${isSender ? '-' : '+'}${transaction.amount} ₽
                    </div>
                `;
                
                transactionsList.appendChild(transactionItem);
            });
        }

        function initUpgrades() {
            const upgradesContainer = document.getElementById('upgradesContainer');
            upgradesContainer.innerHTML = '';
            
            if (!currentUser) return;
            
            // Инициализируем upgrades как объект, если это массив
            if (Array.isArray(currentUser.upgrades)) {
                const upgradesObj = {};
                currentUser.upgrades.forEach(id => {
                    upgradesObj[id] = 1;
                });
                currentUser.upgrades = upgradesObj;
                updateUserInStorage(currentUser.id, { upgrades: upgradesObj });
            }
            
            UPGRADES.forEach(upgrade => {
                const level = currentUser.upgrades[upgrade.id] || 0;
                const currentCost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, level));
                const canAfford = currentUser.balance >= currentCost;
                const canUpgrade = level < upgrade.maxLevel;
                
                const upgradeElement = document.createElement('div');
                upgradeElement.className = `upgrade-item ${!canAfford || !canUpgrade ? 'disabled' : ''}`;
                upgradeElement.innerHTML = `
                    <div class="upgrade-name">${upgrade.name}</div>
                    <div class="upgrade-cost">Стоимость: ${currentCost.toLocaleString('ru-RU')} ₽</div>
                    <div class="upgrade-income">+${upgrade.incomeIncrease} ${upgrade.type === 'click' ? '₽/клик' : '₽/сек'}</div>
                    <div class="upgrade-level">Уровень: ${level}/${upgrade.maxLevel}</div>
                    ${level > 0 ? `<div style="color: #4caf50; margin-top: 5px; font-size: 14px;">Приносит: +${upgrade.incomeIncrease * level} ${upgrade.type === 'click' ? '₽/клик' : '₽/сек'}</div>` : ''}
                `;
                
                if (canAfford && canUpgrade) {
                    upgradeElement.style.cursor = 'pointer';
                    upgradeElement.addEventListener('click', () => buyUpgrade(upgrade.id));
                }
                
                upgradesContainer.appendChild(upgradeElement);
            });
        }

        function buyUpgrade(upgradeId) {
            if (!currentUser) return;
            
            const upgrade = UPGRADES.find(u => u.id === upgradeId);
            if (!upgrade) return;
            
            const level = currentUser.upgrades[upgradeId] || 0;
            const currentCost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, level));
            
            if (currentUser.balance < currentCost) {
                showNotification('Недостаточно средств', 'error');
                return;
            }
            
            if (level >= upgrade.maxLevel) {
                showNotification('Достигнут максимальный уровень улучшения', 'error');
                return;
            }
            
            // Обновляем баланс и уровень улучшения
            const newBalance = currentUser.balance - currentCost;
            const newLevel = level + 1;
            
            const newUpgrades = { ...currentUser.upgrades };
            newUpgrades[upgradeId] = newLevel;
            
            // Применяем улучшение
            let updates = {
                balance: newBalance,
                upgrades: newUpgrades
            };
            
            if (upgrade.type === 'click') {
                updates.incomePerClick = currentUser.incomePerClick + upgrade.incomeIncrease;
            } else {
                updates.passiveIncome = currentUser.passiveIncome + upgrade.incomeIncrease;
            }
            
            // Сохраняем изменения
            const updatedUser = updateUserInStorage(currentUser.id, updates);
            if (updatedUser) {
                const { password: _, ...userWithoutPassword } = updatedUser;
                currentUser = userWithoutPassword;
                
                showNotification(`Улучшение "${upgrade.name}" повышено до уровня ${newLevel}!`, 'success');
                updateUserData();
            }
        }

        function addClick() {
            if (!currentUser) return;
            
            // Начисляем деньги за клик
            const newBalance = currentUser.balance + currentUser.incomePerClick;
            const newClickCount = currentUser.clickCount + 1;
            
            const updatedUser = updateUserInStorage(currentUser.id, {
                balance: newBalance,
                clickCount: newClickCount
            });
            
            if (updatedUser) {
                const { password: _, ...userWithoutPassword } = updatedUser;
                currentUser = userWithoutPassword;
                updateUserData();
                
                // Анимация кнопки
                const clickButton = document.getElementById('clickButton');
                clickButton.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    clickButton.style.transform = 'scale(1)';
                }, 100);
            }
        }

        function transferMoney(recipientId, amount, message) {
            if (!currentUser) return false;
            
            if (currentUser.balance < amount) {
                showNotification('Недостаточно средств', 'error');
                return false;
            }
            
            if (amount < 1) {
                showNotification('Сумма должна быть больше 0', 'error');
                return false;
            }
            
            // Получаем данные отправителя и получателя
            const sender = getUserFromStorage(currentUser.id);
            const recipient = getUserFromStorage(recipientId);
            
            if (!sender || !recipient) {
                showNotification('Пользователь не найден', 'error');
                return false;
            }
            
            if (sender.id === recipient.id) {
                showNotification('Нельзя перевести деньги самому себе', 'error');
                return false;
            }
            
            // Обновляем балансы
            const senderNewBalance = sender.balance - amount;
            const recipientNewBalance = recipient.balance + amount;
            
            updateUserInStorage(sender.id, { balance: senderNewBalance });
            updateUserInStorage(recipient.id, { balance: recipientNewBalance });
            
            // Создаем транзакцию
            const transaction = {
                senderId: sender.id,
                recipientId: recipient.id,
                senderName: sender.name,
                recipientName: recipient.name,
                amount,
                message
            };
            
            addTransactionToStorage(transaction);
            
            // Обновляем данные текущего пользователя
            const updatedUser = getUserFromStorage(currentUser.id);
            if (updatedUser) {
                const { password: _, ...userWithoutPassword } = updatedUser;
                currentUser = userWithoutPassword;
            }
            
            showNotification(`Перевод ${amount}₽ для ${recipient.name} выполнен успешно!`, 'success');
            updateUserData();
            loadUsersList();
            loadTransactions();
            
            return true;
        }

        function startPassiveIncome() {
            setInterval(() => {
                if (!currentUser || currentUser.passiveIncome <= 0) return;
                
                const newBalance = currentUser.balance + currentUser.passiveIncome;
                const updatedUser = updateUserInStorage(currentUser.id, { balance: newBalance });
                
                if (updatedUser) {
                    const { password: _, ...userWithoutPassword } = updatedUser;
                    currentUser = userWithoutPassword;
                    updateUserData();
                    
                    // Показываем уведомление о пассивном доходе раз в 30 секунд
                    if (Math.random() > 0.97) {
                        showNotification(`Пассивный доход: +${currentUser.passiveIncome}₽`, 'info');
                    }
                }
            }, 1000);
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUserId');
            mainInterface.style.display = 'none';
            authContainer.style.display = 'flex';
            
            // Очищаем формы
            loginForm.reset();
            registerForm.reset();
            showAuthForm('login');
        }

        // Обработчики событий
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            loginUser(email, password);
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            registerUser(name, email, password, confirmPassword);
        });

        document.getElementById('clickButton').addEventListener('click', addClick);

        document.getElementById('transferForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const recipientId = document.getElementById('recipient').value;
            const amount = parseInt(document.getElementById('amount').value);
            const message = document.getElementById('message').value;
            
            if (!recipientId) {
                showNotification('Выберите получателя', 'error');
                return;
            }
            
            const success = transferMoney(recipientId, amount, message);
            if (success) {
                document.getElementById('transferForm').reset();
            }
        });

        // Проверяем, есть ли сохраненная сессия
        const savedUserId = localStorage.getItem('currentUserId');
        if (savedUserId) {
            const user = getUserFromStorage(savedUserId);
            if (user) {
                const { password: _, ...userWithoutPassword } = user;
                currentUser = userWithoutPassword;
                showMainInterface();
            }
        }

        // Функция для тестирования
        window.resetBank = function() {
            if (confirm('Вы уверены? Это удалит всех пользователей и историю операций!')) {
                localStorage.removeItem(BANK_STORAGE_KEY);
                localStorage.removeItem('currentUserId');
                location.reload();
            }
        };

        window.addTestUsers = function() {
            const bankData = getBankData();
            
            // Добавляем несколько тестовых пользователей
            const testUsers = [
                { id: 'test1', name: 'Алексей Смирнов', email: 'alex@test.com', password: '123456', balance: 5000, clickCount: 0, incomePerClick: 1, passiveIncome: 0, upgrades: {}, lastUpdate: Date.now() },
                { id: 'test2', name: 'Мария Иванова', email: 'maria@test.com', password: '123456', balance: 3000, clickCount: 0, incomePerClick: 1, passiveIncome: 0, upgrades: {}, lastUpdate: Date.now() },
                { id: 'test3', name: 'Дмитрий Петров', email: 'dmitry@test.com', password: '123456', balance: 7000, clickCount: 0, incomePerClick: 1, passiveIncome: 0, upgrades: {}, lastUpdate: Date.now() }
            ];
            
            // Добавляем только если их нет
            testUsers.forEach(testUser => {
                if (!bankData.users.find(u => u.email === testUser.email)) {
                    bankData.users.push(testUser);
                }
            });
            
            saveBankData(bankData);
            
            if (currentUser) {
                loadUsersList();
                showNotification('Добавлены тестовые пользователи', 'info');
            } else {
                showNotification('Тестовые пользователи добавлены. Теперь вы можете войти под alex@test.com (пароль: 123456)', 'info');
            }
        };
    </script>
</body>
</html>
